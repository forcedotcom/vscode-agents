// Copyright (c) Microsoft Corporation.
// Licensed under the MIT License.

import React from 'react';
import './Timeline.css';

export type TimelineItemStatus = 'success' | 'error' | 'pending' | 'incomplete';

// Icon names for tracer step types (VS Code icons)
export type TimelineIconName =
  | 'account'
  | 'debug-start'
  | 'tools'
  | 'lightbulb'
  | 'symbol-namespace'
  | 'arrow-right'
  | 'checklist'
  | 'search'
  | 'tag'
  | 'run-all'
  | 'check'
  | 'check-all'
  | 'error'
  | 'agent';

export interface TimelineItemProps {
  /**
   * Status of the timeline item
   */
  status: TimelineItemStatus;
  /**
   * Primary text label for the timeline item
   */
  label: string;
  /**
   * Secondary text for additional description
   */
  description?: string;
  /**
   * Optional URL to make the label a clickable link
   */
  href?: string;
  /**
   * Optional click handler for the timeline item
   */
  onClick?: () => void;
  /**
   * Optional icon name to display instead of status-based icon
   */
  icon?: TimelineIconName;
}

export interface TimelineProps extends React.HTMLAttributes<HTMLDivElement> {
  /**
   * Timeline items to display
   */
  items: TimelineItemProps[];
  /**
   * Index of the currently selected item
   */
  selectedIndex?: number;
}

/**
 * The Visual Studio Code timeline component.
 *
 * @remarks
 * A standalone React timeline component that displays a vertical timeline
 * with dots/icons on the left and text labels on the right.
 *
 * @public
 */
export const Timeline = React.forwardRef<HTMLDivElement, TimelineProps>(
  ({ items, selectedIndex, className, ...props }, ref) => {
    const timelineClass = ['vscode-timeline', className].filter(Boolean).join(' ');

    return (
      <div ref={ref} className={timelineClass} {...props}>
        {items.map((item, index) => (
          <TimelineItem
            key={index}
            {...item}
            isLast={index === items.length - 1}
            isSelected={selectedIndex === index}
          />
        ))}
      </div>
    );
  }
);

Timeline.displayName = 'Timeline';

interface TimelineItemInternalProps extends TimelineItemProps {
  isLast: boolean;
  isSelected?: boolean;
}

// SVG icon components for each icon name (VS Code icons from microsoft/vscode-icons)
const getIconByName = (name: TimelineIconName): React.ReactNode => {
  switch (name) {
    case 'account':
      return (
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M16 7.99201C16 3.58042 12.416 0 8 0C3.584 0 0 3.58042 0 7.99201C0 10.4216 1.104 12.6114 2.832 14.0819C2.848 14.0979 2.864 14.0979 2.864 14.1139C3.008 14.2258 3.152 14.3377 3.312 14.4496C3.392 14.4975 3.456 14.5614 3.536 14.6254C4.816 15.4885 6.352 16 8.016 16C9.68 16 11.216 15.4885 12.496 14.6254C12.576 14.5774 12.64 14.5135 12.72 14.4655C12.864 14.3536 13.024 14.2418 13.168 14.1299C13.184 14.1139 13.2 14.1139 13.2 14.0979C14.896 12.6114 16 10.4216 16 7.99201ZM8 14.993C6.496 14.993 5.12 14.5135 3.984 13.7143C4 13.5864 4.032 13.4585 4.064 13.3307C4.16 12.979 4.304 12.6434 4.48 12.3397C4.656 12.036 4.864 11.7642 5.12 11.5245C5.36 11.2847 5.648 11.0609 5.936 10.8851C6.24 10.7093 6.56 10.5814 6.912 10.4855C7.264 10.3896 7.632 10.3417 8 10.3417C8.592 10.3417 9.136 10.4535 9.632 10.6613C10.128 10.8691 10.56 11.1568 10.928 11.5085C11.296 11.8761 11.584 12.3077 11.792 12.8032C11.904 13.0909 11.984 13.3946 12.032 13.7143C10.88 14.5135 9.504 14.993 8 14.993ZM5.552 7.59241C5.408 7.27273 5.344 6.92108 5.344 6.56943C5.344 6.21778 5.408 5.86613 5.552 5.54645C5.696 5.22677 5.888 4.93906 6.128 4.6993C6.368 4.45954 6.656 4.26773 6.976 4.12388C7.296 3.98002 7.648 3.91608 8 3.91608C8.368 3.91608 8.704 3.98002 9.024 4.12388C9.344 4.26773 9.632 4.45954 9.872 4.6993C10.112 4.93906 10.304 5.22677 10.448 5.54645C10.592 5.86613 10.656 6.21778 10.656 6.56943C10.656 6.93706 10.592 7.27273 10.448 7.59241C10.304 7.91209 10.112 8.1998 9.872 8.43956C9.632 8.67932 9.344 8.87113 9.024 9.01499C8.384 9.28671 7.6 9.28671 6.96 9.01499C6.64 8.87113 6.352 8.67932 6.112 8.43956C5.872 8.1998 5.68 7.91209 5.552 7.59241ZM12.976 12.8991C12.976 12.8671 12.96 12.8511 12.96 12.8192C12.8 12.3237 12.576 11.8442 12.272 11.4126C11.968 10.981 11.616 10.5974 11.184 10.2777C10.864 10.038 10.512 9.83017 10.144 9.67033C10.32 9.55844 10.48 9.41459 10.608 9.28671C10.848 9.04695 11.056 8.79121 11.232 8.5035C11.408 8.21578 11.536 7.91209 11.632 7.57642C11.728 7.24076 11.76 6.90509 11.76 6.56943C11.76 6.04196 11.664 5.54645 11.472 5.0989C11.28 4.65135 11.008 4.25175 10.656 3.9001C10.32 3.56444 9.904 3.29271 9.456 3.1009C9.008 2.90909 8.512 2.81319 7.984 2.81319C7.456 2.81319 6.96 2.90909 6.512 3.1009C6.064 3.29271 5.648 3.56444 5.312 3.91608C4.976 4.25175 4.704 4.66733 4.512 5.11489C4.32 5.56244 4.224 6.05794 4.224 6.58541C4.224 6.93706 4.272 7.27273 4.368 7.59241C4.464 7.92807 4.592 8.23177 4.768 8.51948C4.928 8.80719 5.152 9.06294 5.392 9.3027C5.536 9.44655 5.696 9.57443 5.872 9.68631C5.488 9.86214 5.136 10.0699 4.832 10.3097C4.416 10.6294 4.048 11.013 3.744 11.4286C3.44 11.8601 3.216 12.3237 3.056 12.8352C3.04 12.8671 3.04 12.8991 3.04 12.9151C1.776 11.6364 0.992 9.91009 0.992 7.99201C0.992 4.13986 4.144 0.991009 8 0.991009C11.856 0.991009 15.008 4.13986 15.008 7.99201C15.008 9.91009 14.224 11.6364 12.976 12.8991Z"
            fill="currentColor"
          />
        </svg>
      );
    case 'debug-start':
      return (
        <svg width="8" height="10" viewBox="0 0 10 13" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M0.8 0L9.81333 6.02667V6.88L0.8 12.8533L0 12.4267V0.426666L0.8 0ZM1.01333 11.52L8.64 6.45333L1.01333 1.38667V11.52Z"
            fill="currentColor"
          />
        </svg>
      );
    case 'tools':
      return (
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M9.1 4.4L8.6 2H7.4L6.9 4.4L6.2 4.7L4.2 3.4L3.3 4.2L4.6 6.2L4.4 6.9L2 7.4V8.6L4.4 9.1L4.7 9.9L3.4 11.9L4.2 12.7L6.2 11.4L7 11.7L7.4 14H8.6L9.1 11.6L9.9 11.3L11.9 12.6L12.7 11.8L11.4 9.8L11.7 9L14 8.6V7.4L11.6 6.9L11.3 6.1L12.6 4.1L11.8 3.3L9.8 4.6L9.1 4.4ZM9.4 1L9.9 3.4L12 2.1L14 4.1L12.6 6.2L15 6.6V9.4L12.6 9.9L14 12L12 14L9.9 12.6L9.4 15H6.6L6.1 12.6L4 13.9L2 11.9L3.4 9.8L1 9.4V6.6L3.4 6.1L2.1 4L4.1 2L6.2 3.4L6.6 1H9.4ZM10 8C10 9.1 9.1 10 8 10C6.9 10 6 9.1 6 8C6 6.9 6.9 6 8 6C9.1 6 10 6.9 10 8ZM8 9C8.6 9 9 8.6 9 8C9 7.4 8.6 7 8 7C7.4 7 7 7.4 7 8C7 8.6 7.4 9 8 9Z"
            fill="currentColor"
          />
        </svg>
      );
    case 'lightbulb':
      return (
        <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M6.60979 0.023124C6.84049 0.0693873 7.04828 0.161678 7.23284 0.300468C7.46341 0.439181 7.62491 0.647142 7.71721 0.924491L8.34026 2.72918C8.47868 3.19181 8.70966 3.58502 9.03264 3.90887C9.40166 4.23259 9.81651 4.46442 10.2778 4.6032L12.0082 5.22723C12.3312 5.31975 12.5622 5.48224 12.7006 5.71355C12.8389 5.89847 12.9308 6.10647 12.977 6.33758C13.0231 6.52263 13.0009 6.73126 12.9086 6.96258C12.8625 7.14755 12.7696 7.30919 12.6313 7.44793C12.4929 7.5867 12.3082 7.70209 12.0776 7.79461L10.2778 8.35027C9.81651 8.53531 9.42487 8.79019 9.10198 9.11394L8.98381 9.23797C8.71625 9.53656 8.50179 9.88873 8.34026 10.2936L7.78655 12.0973C7.69427 12.3749 7.53287 12.6066 7.30217 12.7917L7.2133 12.8405C7.00139 12.9467 6.75365 12.9997 6.47112 12.9997V11.9997C6.59607 11.9997 6.67804 11.9803 6.73186 11.9596C6.78125 11.9077 6.8143 11.8512 6.83733 11.7819L7.3842 9.99969C7.39219 9.97367 7.40146 9.94782 7.41155 9.92254C7.64173 9.34562 7.9673 8.83571 8.39397 8.40789C8.82065 7.98007 9.32964 7.65362 9.90569 7.42254L9.98381 7.39422L11.724 6.85711C11.8477 6.80529 11.9035 6.76165 11.9233 6.74187C11.9283 6.73685 11.9314 6.73328 11.933 6.73113C11.9346 6.72903 11.936 6.72723 11.936 6.72723C11.936 6.72723 11.9371 6.72382 11.9379 6.72039L11.9789 6.59148C11.9899 6.56407 11.9939 6.54489 11.9965 6.53387L11.9594 6.41375C11.9433 6.37726 11.9235 6.34386 11.8998 6.31219L11.849 6.23699C11.8403 6.23087 11.8073 6.21049 11.7328 6.18914C11.7114 6.18298 11.6904 6.17523 11.6694 6.16766L9.93889 5.54363C9.35835 5.36119 8.83346 5.06524 8.37248 4.66082C8.35587 4.64624 8.34025 4.63057 8.32463 4.61492C7.88806 4.17718 7.57955 3.65089 7.39495 3.05535L6.7719 1.25164L6.76799 1.2409C6.75365 1.19777 6.74089 1.17886 6.73674 1.17351C6.73337 1.16918 6.72901 1.16401 6.71721 1.15691C6.68787 1.13925 6.65963 1.11988 6.63225 1.0993C6.5696 1.05218 6.50033 1.02103 6.4135 1.00359C6.40255 1.00642 6.38394 1.01053 6.35979 1.02019C6.34119 1.02765 6.32118 1.03242 6.30217 1.03875C6.27404 1.07627 6.24349 1.11199 6.21038 1.14519C6.16338 1.19233 6.12128 1.2498 6.08147 1.31902L5.55998 3.01531C5.36677 3.66108 5.00917 4.2153 4.50139 4.66082C4.08417 5.06604 3.59964 5.36814 3.0512 5.55144L3.05022 5.55047L1.26311 6.17254C1.22915 6.18433 1.19364 6.19182 1.15862 6.19988C1.13634 6.22758 1.1144 6.25575 1.08928 6.28094C1.07274 6.29755 1.0414 6.34021 1.00041 6.42547C1.00046 6.4514 1.00492 6.48675 1.01311 6.53387C1.02919 6.58746 1.06443 6.67162 1.13127 6.79168C1.15065 6.80411 1.18675 6.82451 1.24846 6.84539L3.02873 7.39422C3.03616 7.39651 3.04383 7.39957 3.0512 7.40203C3.80595 7.6543 4.44291 8.12204 4.96233 8.75848C4.98288 8.78366 5.00194 8.81051 5.01995 8.83758C5.24006 9.16863 5.43021 9.5234 5.59123 9.90008C5.60513 9.93258 5.61797 9.96589 5.62834 9.99969L6.17717 11.7897C6.20067 11.8574 6.23486 11.9125 6.28459 11.9636C6.33878 11.9865 6.39787 11.9996 6.47112 11.9997V12.9997C6.26349 12.9996 6.0688 12.9606 5.88713 12.8825L5.71038 12.7917C5.50866 12.6299 5.35998 12.4324 5.26409 12.1999L5.226 12.0973L4.67229 10.2936C4.53391 9.96988 4.37241 9.6688 4.18791 9.39129C3.77265 8.88239 3.28749 8.53533 2.73381 8.35027L0.934984 7.79461C0.692664 7.71362 0.502893 7.59786 0.366625 7.44598L0.311938 7.37859C0.208129 7.20511 0.130443 7.04461 0.0785392 6.89715L0.0345938 6.75457C-0.0115388 6.52329 -0.0115238 6.3146 0.0345938 6.12957C0.126845 5.89833 0.242911 5.71366 0.381274 5.57488C0.519694 5.38983 0.704283 5.27349 0.934984 5.22723L2.73381 4.6032C3.14902 4.46443 3.51829 4.23264 3.84123 3.90887C4.16428 3.62545 4.39899 3.28882 4.54534 2.8991L4.60295 2.72918L5.15666 0.924491C5.24889 0.739654 5.36409 0.577805 5.50237 0.43914C5.64069 0.25422 5.80235 0.13879 5.98674 0.09246C6.21739 -4.59999e-05 6.42526 -0.023098 6.60979 0.023124Z"
            fill="currentColor"
          />
        </svg>
      );
    case 'symbol-namespace':
      return (
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M6 2.98361V2.97184V2H5.91083C5.59743 2 5.29407 2.06161 5.00128 2.18473C4.70818 2.30798 4.44942 2.48474 4.22578 2.71498C4.00311 2.94422 3.83792 3.19498 3.73282 3.46766L3.73233 3.46898C3.63382 3.7352 3.56814 4.01201 3.53533 4.29917L3.53519 4.30053C3.50678 4.5805 3.4987 4.86844 3.51084 5.16428C3.52272 5.45379 3.52866 5.74329 3.52866 6.03279C3.52866 6.23556 3.48974 6.42594 3.412 6.60507L3.4116 6.60601C3.33687 6.78296 3.23423 6.93866 3.10317 7.07359C2.97644 7.20405 2.82466 7.31055 2.64672 7.3925C2.4706 7.46954 2.28497 7.5082 2.08917 7.5082H2V7.6V8.4V8.4918H2.08917C2.28465 8.4918 2.47001 8.53238 2.64601 8.61334L2.64742 8.61396C2.82457 8.69157 2.97577 8.79762 3.10221 8.93161L3.10412 8.93352C3.23428 9.0637 3.33659 9.21871 3.41129 9.39942L3.41201 9.40108C3.48986 9.58047 3.52866 9.76883 3.52866 9.96721C3.52866 10.2567 3.52272 10.5462 3.51084 10.8357C3.4987 11.1316 3.50677 11.4215 3.53516 11.7055L3.53535 11.7072C3.56819 11.9903 3.63387 12.265 3.73232 12.531L3.73283 12.5323C3.83793 12.805 4.00311 13.0558 4.22578 13.285C4.44942 13.5153 4.70818 13.692 5.00128 13.8153C5.29407 13.9384 5.59743 14 5.91083 14H6V13.2V13.0164H5.91083C5.71095 13.0164 5.52346 12.9777 5.34763 12.9008C5.17396 12.8191 5.02194 12.7126 4.89086 12.5818C4.76386 12.4469 4.66104 12.2911 4.58223 12.1137C4.50838 11.9346 4.47134 11.744 4.47134 11.541C4.47134 11.3127 4.4753 11.0885 4.48321 10.8686C4.49125 10.6411 4.49127 10.4195 4.48324 10.2039C4.47914 9.98246 4.46084 9.76883 4.42823 9.56312C4.39513 9.35024 4.33921 9.14757 4.26039 8.95536C4.18091 8.76157 4.07258 8.57746 3.93616 8.40298C3.82345 8.25881 3.68538 8.12462 3.52283 8C3.68538 7.87538 3.82345 7.74119 3.93616 7.59702C4.07258 7.42254 4.18091 7.23843 4.26039 7.04464C4.33913 6.85263 4.39513 6.65175 4.42826 6.44285C4.46082 6.2333 4.47914 6.01973 4.48324 5.80219C4.49127 5.58262 4.49125 5.36105 4.48321 5.13749C4.4753 4.9134 4.47134 4.68725 4.47134 4.45902C4.47134 4.26019 4.50833 4.07152 4.58238 3.89205C4.66135 3.71034 4.76421 3.55475 4.89086 3.42437C5.02193 3.28942 5.17461 3.18275 5.34802 3.10513C5.5238 3.02427 5.71113 2.98361 5.91083 2.98361H6ZM10 13.0164V13.0282V14H10.0892C10.4026 14 10.7059 13.9384 10.9987 13.8153C11.2918 13.692 11.5506 13.5153 11.7742 13.285C11.9969 13.0558 12.1621 12.805 12.2672 12.5323L12.2677 12.531C12.3662 12.2648 12.4319 11.988 12.4647 11.7008L12.4648 11.6995C12.4932 11.4195 12.5013 11.1316 12.4892 10.8357C12.4773 10.5462 12.4713 10.2567 12.4713 9.96721C12.4713 9.76444 12.5103 9.57406 12.588 9.39493L12.5884 9.39399C12.6631 9.21704 12.7658 9.06134 12.8968 8.92642C13.0236 8.79595 13.1753 8.68945 13.3533 8.6075C13.5294 8.53046 13.715 8.4918 13.9108 8.4918H14V8.4V7.6V7.5082H13.9108C13.7153 7.5082 13.53 7.46762 13.354 7.38666L13.3526 7.38604C13.1754 7.30844 13.0242 7.20238 12.8978 7.06839L12.8959 7.06648C12.7657 6.9363 12.6634 6.78129 12.5887 6.60058L12.588 6.59892C12.5101 6.41953 12.4713 6.23117 12.4713 6.03279C12.4713 5.74329 12.4773 5.45379 12.4892 5.16428C12.5013 4.86842 12.4932 4.57848 12.4648 4.29454L12.4646 4.29285C12.4318 4.00971 12.3661 3.73502 12.2677 3.46897L12.2672 3.46766C12.1621 3.19499 11.9969 2.94422 11.7742 2.71498C11.5506 2.48474 11.2918 2.30798 10.9987 2.18473C10.7059 2.06161 10.4026 2 10.0892 2H10V2.8V2.98361H10.0892C10.2891 2.98361 10.4765 3.0223 10.6524 3.09917C10.826 3.18092 10.9781 3.28736 11.1091 3.41823C11.2361 3.55305 11.339 3.70889 11.4178 3.88628C11.4916 4.0654 11.5287 4.25596 11.5287 4.45902C11.5287 4.68727 11.5247 4.91145 11.5168 5.13142C11.5088 5.35894 11.5087 5.58049 11.5168 5.79605C11.5209 6.01754 11.5392 6.23117 11.5718 6.43688C11.6049 6.64976 11.6608 6.85243 11.7396 7.04464C11.8191 7.23843 11.9274 7.42254 12.0638 7.59702C12.1765 7.74119 12.3146 7.87538 12.4772 8C12.3146 8.12462 12.1765 8.25881 12.0638 8.40298C11.9274 8.57746 11.8191 8.76157 11.7396 8.95536C11.6609 9.14737 11.6049 9.34825 11.5717 9.55715C11.5392 9.7667 11.5209 9.98027 11.5168 10.1978C11.5087 10.4174 11.5087 10.6389 11.5168 10.8625C11.5247 11.0866 11.5287 11.3128 11.5287 11.541C11.5287 11.7398 11.4917 11.9285 11.4176 12.1079C11.3386 12.2897 11.2358 12.4452 11.1091 12.5756C10.9781 12.7106 10.8254 12.8173 10.652 12.8949C10.4762 12.9757 10.2889 13.0164 10.0892 13.0164H10Z"
            fill="currentColor"
          />
        </svg>
      );
    case 'arrow-right':
      return (
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M9.00001 13.8871L14 8.8871V8.17999L9.00001 3.17999L8.2929 3.8871L12.4393 8.03354H2V9.03354H12.4393L8.2929 13.18L9.00001 13.8871Z"
            fill="currentColor"
          />
        </svg>
      );
    case 'checklist':
      return (
        <svg width="13" height="12" viewBox="0 0 13 12" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M1.70667 2.50667H1.01333L0 1.44L0.693333 0.746666L1.38667 1.44L2.77333 0L3.52 0.746666L1.70667 2.50667ZM4.96 1.01333H12.96V2.02667H4.96V1.01333ZM4.96 4H12.96V5.01333H4.96V4ZM12.96 7.04H4.96V8H12.96V7.04ZM4.96 10.0267H12.96V11.04H4.96V10.0267ZM1.01333 5.49333H1.70667L3.52 3.73333L2.77333 3.04L1.38667 4.42667L0.693333 3.73333L0 4.48L1.01333 5.49333ZM1.70667 8.53333H1.01333L0 7.46667L0.693333 6.77333L1.38667 7.46667L2.77333 6.02667L3.52 6.72L1.70667 8.53333ZM1.01333 11.52H1.70667L3.52 9.76L2.77333 9.06667L1.38667 10.4533L0.693333 9.76L0 10.4533L1.01333 11.52Z"
            fill="currentColor"
          />
        </svg>
      );
    case 'search':
      return (
        <svg width="13" height="13" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M7.12 0C8 0 8.8 0.266667 9.52 0.8C10.2667 1.33333 10.7733 2.04 11.04 2.92C11.3067 3.77333 11.2933 4.62667 11 5.48C10.7067 6.33333 10.1867 7.01333 9.44 7.52C8.69333 8.02667 7.86667 8.26667 6.96 8.24C6.08 8.21333 5.28 7.92 4.56 7.36L0.56 11.92L0 11.44L4 6.84C3.46667 6.25333 3.13333 5.56 3 4.76C2.89333 3.96 3 3.18667 3.32 2.44C3.66667 1.69333 4.17333 1.10667 4.84 0.68C5.53333 0.226667 6.29333 0 7.12 0ZM7.12 7.48V7.52C7.73333 7.52 8.29333 7.37333 8.8 7.08C9.30667 6.76 9.70667 6.34667 10 5.84C10.32 5.30667 10.48 4.73333 10.48 4.12C10.48 3.50667 10.32 2.94667 10 2.44C9.70667 1.90667 9.30667 1.49333 8.8 1.2C8.29333 0.906667 7.73333 0.76 7.12 0.76C6.50667 0.76 5.93333 0.906667 5.4 1.2C4.89333 1.49333 4.48 1.90667 4.16 2.44C3.86667 2.94667 3.72 3.50667 3.72 4.12C3.72 4.73333 3.86667 5.30667 4.16 5.84C4.48 6.34667 4.89333 6.74667 5.4 7.04C5.93333 7.33333 6.50667 7.48 7.12 7.48Z"
            fill="currentColor"
          />
        </svg>
      );
    case 'tag':
      return (
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M13.2 2H8.017L7.664 2.146L1 8.81V9.517L6.183 14.7H6.89L9.10507 12.4853C9.65808 12.7768 10.2674 12.9502 10.8942 12.9923C11.6588 13.0437 12.4238 12.8981 13.116 12.5694C13.8082 12.2407 14.4046 11.74 14.8481 11.1151C15.2915 10.4902 15.5673 9.76192 15.649 9C15.6757 8.83446 15.6927 8.66751 15.7 8.5C15.6987 7.30693 15.2242 6.16311 14.3805 5.31948C14.1709 5.10988 13.9428 4.92307 13.7 4.76064V2.5L13.2 2ZM12.7 4.25881C12.2227 4.08965 11.716 4.00057 11.2 4C11.0674 4 10.9402 4.05268 10.8465 4.14645C10.7527 4.24021 10.7 4.36739 10.7 4.5C10.7 4.63261 10.7527 4.75979 10.8465 4.85355C10.9402 4.94732 11.0674 5 11.2 5C11.7238 5 12.2356 5.11743 12.7 5.33771V7.476L8.77481 11.4005C8.75743 11.4095 8.74054 11.4194 8.72425 11.4304C8.66826 11.468 8.62046 11.5166 8.58373 11.5731C8.5745 11.5874 8.56602 11.602 8.55831 11.617L6.536 13.639L2.061 9.163L8.224 3H12.7V4.25881ZM13.7 6.0505C14.3407 6.70435 14.7 7.58365 14.7 8.5C14.6952 8.66769 14.6782 8.8348 14.649 9C14.5673 9.58097 14.3404 10.1319 13.9892 10.6019C13.638 11.0719 13.174 11.4457 12.64 11.6888C12.1061 11.9319 11.5194 12.0363 10.9344 11.9925C10.562 11.9646 10.1979 11.8772 9.85564 11.7348L13.554 8.037L13.7 7.683V6.0505Z"
            fill="currentColor"
          />
        </svg>
      );
    case 'run-all':
      return (
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M2.78 5.78003L6 8.99003L2.78 12.22L2 11.5L4.44 8.99003L2 6.50003L2.78 5.78003ZM8 12H14V13H8V12Z"
            fill="currentColor"
          />
        </svg>
      );
    case 'check':
      return (
        <svg width="10" height="8" viewBox="0 0 13 11" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M12.64 0.64L4.16 10.6667L3.36 10.6133L0 5.86667L0.8 5.28L3.78667 9.49333L11.84 0L12.64 0.64Z"
            fill="currentColor"
          />
        </svg>
      );
    case 'check-all':
      return (
        <svg width="14" height="9" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M15.6267 0.586666L7.84 9.81333H7.09333L4 5.38667L4.74667 4.85333L7.52 8.74667L14.9333 0L15.6267 0.586666ZM7.25333 5.81333L11.6267 0.586666L10.9333 0L6.66667 5.01333L7.25333 5.81333ZM5.70667 6.18667L6.24 6.98667L5.70667 6.18667ZM4.05333 8.10667L4.64 8.90667L3.84 9.81333H3.09333L0 5.38667L0.746667 4.85333L3.52 8.74667L4.05333 8.10667Z"
            fill="currentColor"
          />
        </svg>
      );
    case 'error':
      return (
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M12.32 11.26L9.06 8L12.32 4.74L11.26 3.68L8 6.94L4.74 3.68L3.68 4.74L6.94 8L3.68 11.26L4.74 12.32L8 9.06L11.26 12.32L12.32 11.26Z"
            fill="currentColor"
          />
        </svg>
      );
    case 'agent':
      return (
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M12.002 3.5C12.9714 3.5 13.7226 4.24938 13.7227 5.12988C13.7227 5.72078 13.3857 6.24992 12.8662 6.54004L12.6104 6.68359V8.82715H15.8887C19.0057 8.82715 21.4999 11.2488 21.5 14.1895C21.5 15.3666 21.1378 16.6975 20.2705 17.7246C19.4162 18.7363 18.0335 19.5 15.8887 19.5H8.11133C4.29096 19.5 2.5 16.5548 2.5 14.1895C2.50011 11.2488 4.99433 8.82715 8.11133 8.82715H11.3896V6.68262L11.1328 6.53906C10.6114 6.24983 10.2773 5.7223 10.2773 5.12988C10.2774 4.24938 11.0286 3.5 11.998 3.5H12.002ZM8.11133 9.96094C5.70746 9.96094 3.72472 11.8338 3.72461 14.1895C3.72461 16.5452 5.70739 18.418 8.11133 18.418H15.8887C18.2926 18.418 20.2754 16.5452 20.2754 14.1895C20.2753 11.8338 18.2925 9.96094 15.8887 9.96094H8.11133ZM8.2168 12.5264C8.97493 12.5264 9.55162 13.2966 9.55176 14.2373C9.55176 15.1781 8.97503 15.9492 8.2168 15.9492C7.45875 15.949 6.88281 15.178 6.88281 14.2373C6.88295 13.2968 7.45884 12.5266 8.2168 12.5264ZM15.8145 12.5264C16.5726 12.5264 17.1493 13.2966 17.1494 14.2373C17.1494 15.1781 16.5727 15.9492 15.8145 15.9492C15.0563 15.949 14.4795 15.178 14.4795 14.2373C14.4796 13.2967 15.0564 12.5265 15.8145 12.5264Z"
            fill="currentColor"
          />
        </svg>
      );
    default:
      return null;
  }
};

const TimelineItem: React.FC<TimelineItemInternalProps> = ({
  status,
  label,
  description,
  href,
  onClick,
  isLast,
  icon,
  isSelected
}) => {
  const itemRef = React.useRef<HTMLDivElement>(null);

  const getIconContent = () => {
    // If a custom icon is provided, use it
    if (icon) {
      return getIconByName(icon);
    }

    // Fall back to status-based icons
    switch (status) {
      case 'success':
        return getIconByName('check');
      case 'error':
        return getIconByName('error');
      case 'pending':
      case 'incomplete':
      default:
        return <div className="vscode-timeline-item__dot" />;
    }
  };

  const itemClass = [
    'vscode-timeline-item',
    `vscode-timeline-item--${status}`,
    isLast && 'vscode-timeline-item--last',
    onClick && 'vscode-timeline-item--clickable',
    isSelected && 'vscode-timeline-item--selected'
  ]
    .filter(Boolean)
    .join(' ');

  const handleClick = () => {
    if (onClick) {
      onClick();
      // Scroll the clicked item into view within the trace history list only
      requestAnimationFrame(() => {
        const element = itemRef.current;
        if (!element) return;

        // Find the scrollable container (.trace-history-list)
        const scrollContainer = element.closest('.trace-history-list');
        if (!scrollContainer) return;

        // Calculate position relative to the scroll container
        const elementRect = element.getBoundingClientRect();
        const containerRect = scrollContainer.getBoundingClientRect();
        const scrollTop = scrollContainer.scrollTop;

        // Account for sticky header (approximately 32px)
        const stickyHeaderOffset = 32;
        const targetScrollTop = scrollTop + (elementRect.top - containerRect.top) - stickyHeaderOffset;

        scrollContainer.scrollTo({
          top: Math.max(0, targetScrollTop),
          behavior: 'smooth'
        });
      });
    }
  };

  return (
    <div ref={itemRef} className={itemClass} onClick={handleClick} style={onClick ? { cursor: 'pointer' } : undefined}>
      <div className="vscode-timeline-item__indicator">
        <div className="vscode-timeline-item__icon">{getIconContent()}</div>
        {!isLast && <div className="vscode-timeline-item__line" />}
      </div>
      <div className="vscode-timeline-item__content">
        {href ? (
          <a href={href} className="vscode-timeline-item__link">
            <div className="vscode-timeline-item__label">{label}</div>
            {description && <div className="vscode-timeline-item__description">{description}</div>}
          </a>
        ) : (
          <>
            <div className="vscode-timeline-item__label">{label}</div>
            {description && <div className="vscode-timeline-item__description">{description}</div>}
          </>
        )}
      </div>
    </div>
  );
};
